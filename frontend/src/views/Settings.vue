<template>
    <div class="text-gray-800 dark:text-gray-200">
        <!-- È°µÈù¢Â§¥ÈÉ® -->
        <div class="settings-header container mx-auto px-4 py-4">
            <h1 class="page-title flex items-center text-2xl md:text-3xl font-bold">
                ËÆæÁΩÆ
            </h1>
            <p class="page-description text-gray-600 dark:text-gray-400 mt-2">ÁÆ°ÁêÜÊÇ®ÁöÑÁ≥ªÁªüËÆæÁΩÆ</p>
        </div>

        <!-- ‰∏ªË¶ÅÂÜÖÂÆπ -->
        <div class="container mx-auto px-4 pb-16">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">

                <!-- Á≥ªÁªüÈÖçÁΩÆÂç°Áâá -->
                <div class="order-1 md:order-2 w-full p-0 mx-auto">
                    <div class="panel-content p-6 md:p-8 bg-white dark:bg-gray-800 rounded-xl shadow-md">
                        <h2 class="panel-title flex items-center text-xl font-semibold mb-8">
                            <span class="panel-icon mr-2 text-2xl">
                                <i class="ri-list-settings-line"></i>
                            </span>
                            Á≥ªÁªüÈÖçÁΩÆ
                        </h2>
                        
                        <div class="account-form space-y-6">
                            <!-- ÁΩëÁ´ôÂüüÂêçÔºöÂ§±ÂéªÁÑ¶ÁÇπ‰øùÂ≠?-->
                            <div class="setting-group">
                                <label class="setting-label block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" for="site_domain">
                                    ÁΩëÁ´ôÂüüÂêç
                                </label>
                                <input 
                                    id="site_domain"
                                    v-model="systemSettings.site_domain"
                                    type="text" 
                                    class="setting-input w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary focus:border-primary dark:focus:ring-primary/70 dark:focus:border-primary/70 transition-colors outline-none"
                                    placeholder="Â¶ÇÔºöexample.com Êà?https://example.com"
                                    @blur="handleFieldBlur('site_domain', systemSettings.site_domain)"
                                />
                                <div class="mt-1 text-gray-500 dark:text-gray-400 text-xs">
                                    Áî®‰∫é Telegram Webhook Á≠âÂäüËÉΩÔºåÊó†ÈúÄÂ°´ÂÜôÊú´Â∞æÊñúÊù†
                                </div>
                            </div>
                            
                            <!-- TG Bot TokenÔºöÂ§±ÂéªÁÑ¶ÁÇπ‰øùÂ≠?-->
                            <div class="setting-group">
                                <label class="setting-label block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" for="tg_bot_token">
                                    TG Bot Token
                                </label>
                                <input 
                                    id="tg_bot_token"
                                    v-model="systemSettings.tg_bot_token"
                                    type="text" 
                                    class="setting-input w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary focus:border-primary dark:focus:ring-primary/70 dark:focus:border-primary/70 transition-colors outline-none"
                                    placeholder="ËØ∑ËæìÂÖ•TG Bot Token"
                                    @blur="handleFieldBlur('tg_bot_token', systemSettings.tg_bot_token)"
                                />
                                <div class="mt-1 text-gray-500 dark:text-gray-400 text-xs">
                                    Â≠òÂÇ®ÈÄâÊã©TelegramÊó∂ÂøÖÂ°?
                                </div>
                            </div>
                            
                            <!-- TG ÈÄöÁü•Êé•Êî∂ËÄÖÔºöÂ§±ÂéªÁÑ¶ÁÇπ‰øùÂ≠ò -->
                            <div class="setting-group">
                                <label class="setting-label block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" for="tg_receivers">
                                    TG ÈÄöÁü•Êé•Êî∂ËÄ?
                                </label>
                                <input 
                                    id="tg_receivers"
                                    v-model="systemSettings.tg_receivers"
                                    type="text" 
                                    class="setting-input w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary focus:border-primary dark:focus:ring-primary/70 dark:focus:border-primary/70 transition-colors outline-none"
                                    placeholder="Êé•Êî∂ÈÄöÁü•ÁöÑTGÁî®Êà∑ID"
                                    @blur="handleFieldBlur('tg_receivers', systemSettings.tg_receivers)"
                                />
                                <div class="mt-1 text-gray-500 dark:text-gray-400 text-xs">
                                    Â≠òÂÇ®ÈÄâÊã©TelegramÊó∂ÂøÖÂ°?
                                </div>
                            </div>
                            
                            <!-- TG ÈÄöÁü•ÊñáÊú¨ÔºöÂ§±ÂéªÁÑ¶ÁÇπ‰øùÂ≠?-->
                            <div class="setting-group">
                                <label class="setting-label block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" for="tg_notice_text">
                                    TG ÈÄöÁü•ÊñáÊú¨
                                </label>
                                <input 
                                    id="tg_notice_text"
                                    v-model="systemSettings.tg_notice_text"
                                    type="text" 
                                    class="setting-input w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary focus:border-primary dark:focus:ring-primary/70 dark:focus:border-primary/70 transition-colors outline-none"
                                    placeholder="Ëá™ÂÆö‰πâTGÈÄöÁü•ÊñáÊú¨"
                                    @blur="handleFieldBlur('tg_notice_text', systemSettings.tg_notice_text)"
                                />
                                <div class="mt-1 text-gray-500 dark:text-gray-400 text-xs">
                                    ÈªòËÆ§Ê®°ÊùøÔºö{username} {date} ‰∏ä‰º†‰∫ÜÂõæÁâ?{filename}ÔºåÂ≠òÂÇ®ÂÆπÂô®[{StorageType}]
                                </div>
                            </div>
                            
                            <!-- Â≠òÂÇ®Á±ªÂûãÔºö‰∏ãÊãâÊ°ÜÂèòÊõ¥‰øùÂ≠ò -->
                            <div class="setting-group">
                                <label class="setting-label block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" for="storage_type">
                                    Â≠òÂÇ®Á±ªÂûã
                                </label>
                                <select 
                                    id="storage_type"
                                    v-model="systemSettings.storage_type"
                                    class="setting-input w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary focus:border-primary dark:focus:ring-primary/70 dark:focus:border-primary/70 transition-colors outline-none"
                                    @change="handleSelectChange('storage_type', systemSettings.storage_type)"
                                >
                                    <option value="" disabled>ËØ∑ÈÄâÊã©Â≠òÂÇ®Á±ªÂûã</option>
                                    <option value="default">Êú¨Âú∞Â≠òÂÇ®</option>
                                    <option value="s3">S3</option>
                                    <option value="r2">R2</option>
                                    <option value="webdav">WebDav</option>
                                    <option value="ftp">FTP</option>

                                    <option value="telegram">Telegram</option>
                                    <option value="custom">NodeSeek / Ëá™ÂÆö‰π?API</option>
                                </select>
                                <div class="mt-1 text-gray-500 dark:text-gray-400 text-xs">
                                    <span v-if="systemSettings.storage_type === 'telegram'">ÈÄâÊã©TelegramÂ≠òÂÇ®ÂøÖÈ°ª‰ΩøÁî®Êµ∑Â§ñÊúçÂä°Âô®ÔºåÂê¶ÂàôÊó†Ê≥ïÊ≠£Â∏∏‰∏ä‰º†„ÄÅÊü•Áúã„ÄÅÂà†Èô§ÂõæÁâ?/span>
                                    <span v-else-if="systemSettings.storage_type === 'custom'">ÊîØÊåÅ NodeSeek ÂõæÂ∫ä API Ê†ºÂºè</span>
                                </div>
                            </div>

                            <!-- Custom APIÈÖçÁΩÆÔºöÂ§±ÂéªÁÑ¶ÁÇπ‰øùÂ≠?-->
                            <div v-if="systemSettings.storage_type === 'custom'" class="space-y-4 pt-2 border-t border-gray-200 dark:border-gray-700"> 
                                <h3 class="font-bold text-sm text-gray-800 dark:text-gray-200">Ëá™ÂÆö‰π?API ÈÖçÁΩÆ</h3>

                                <div class="setting-group"> 
                                    <label class="setting-label block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" for="custom_api_url">
                                        API Âú∞ÂùÄ (URL)
                                    </label>
                                    <input 
                                        id="custom_api_url"
                                        v-model="systemSettings.custom_api_url"
                                        type="text"
                                        class="setting-input w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary focus:border-primary dark:focus:ring-primary/70 dark:focus:border-primary/70 transition-colors outline-none"
                                        placeholder="Â¶?https://api.nodeimage.com"
                                        @blur="handleFieldBlur('custom_api_url', systemSettings.custom_api_url)"
                                    />
                                    <div class="mt-1 text-gray-500 dark:text-gray-400 text-xs">
                                        Â°´ÂÜôÂÆåÊï¥Áö?API ÂüüÂêçÊàñÊ†πË∑ØÂæÑÔºåÊó†ÈúÄÂåÖÂê´ /api/upload
                                    </div>
                                </div>
                                <div class="setting-group"> 
                                    <label class="setting-label block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" for="custom_api_key">
                                        API Key
                                    </label>
                                    <input 
                                        id="custom_api_key"
                                        v-model="systemSettings.custom_api_key"
                                        type="text"
                                        class="setting-input w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary focus:border-primary dark:focus:ring-primary/70 dark:focus:border-primary/70 transition-colors outline-none"
                                        placeholder="ËØ∑ËæìÂÖ?API Key"
                                        @blur="handleFieldBlur('custom_api_key', systemSettings.custom_api_key)"
                                    />
                                </div>
                            </div>
                            
                            <!-- Watermark and Referer settings moved to left column -->

                            <!-- S3/R2ÈÖçÁΩÆÔºöÂ§±ÂéªÁÑ¶ÁÇπ‰øùÂ≠?-->
                            <div v-if="['s3', 'r2'].includes(systemSettings.storage_type)" class="space-y-4 pt-2 border-t border-gray-200 dark:border-gray-700">
                                <h3 class="font-bold text-sm text-gray-800 dark:text-gray-200">S3/R2 ÈÖçÁΩÆ</h3>
                                
                                <div class="setting-group"> 
                                    <label class="setting-label block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" for="s3_endpoint">
                                        S3 Endpoint
                                    </label>
                                    <input 
                                        id="s3_endpoint"
                                        v-model="systemSettings.s3_endpoint"
                                        type="text" 
                                        class="setting-input w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary focus:border-primary dark:focus:ring-primary/70 dark:focus:border-primary/70 transition-colors outline-none"
                                        placeholder="Â¶ÇÔºös3.us-west-004.backblazeb2.com"
                                        @blur="handleFieldBlur('s3_endpoint', systemSettings.s3_endpoint)"
                                    />
                                </div>
                                
                                <div class="setting-group"> 
                                    <label class="setting-label block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" for="s3_access_key">
                                        S3 AccessKey
                                    </label>
                                    <input 
                                        id="s3_access_key"
                                        v-model="systemSettings.s3_access_key"
                                        type="text" 
                                        class="setting-input w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary focus:border-primary dark:focus:ring-primary/70 dark:focus:border-primary/70 transition-colors outline-none"
                                        placeholder="S3ËÆøÈóÆÂØÜÈí•ID"
                                        @blur="handleFieldBlur('s3_access_key', systemSettings.s3_access_key)"
                                    />
                                </div>
                                
                                <div class="setting-group"> 
                                    <label class="setting-label block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" for="s3_secret_key">
                                        S3 SecretKey
                                    </label>
                                    <input 
                                        id="s3_secret_key"
                                        v-model="systemSettings.s3_secret_key"
                                        type="password" 
                                        class="setting-input w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary focus:border-primary dark:focus:ring-primary/70 dark:focus:border-primary/70 transition-colors outline-none"
                                        placeholder="S3ÁßÅÊúâËÆøÈóÆÂØÜÈí•"
                                        @blur="handleFieldBlur('s3_secret_key', systemSettings.s3_secret_key)"
                                    />
                                </div>
                                
                                <div class="setting-group"> 
                                    <label class="setting-label block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" for="S3Bucket">
                                        S3 Bucket
                                    </label>
                                    <input 
                                        id="S3Bucket"
                                        v-model="systemSettings.s3_bucket"
                                        type="text" 
                                        class="setting-input w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary focus:border-primary dark:focus:ring-primary/70 dark:focus:border-primary/70 transition-colors outline-none"
                                        placeholder="Â≠òÂÇ®Ê°∂ÂêçÁß?
                                        @blur="handleFieldBlur('s3_bucket', systemSettings.s3_bucket)"
                                    />
                                </div>
                                
                                <div class="setting-group"> 
                                    <label class="setting-label block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" for="s3_custom_url">
                                        Ëá™ÂÆö‰πâËÆøÈó?URLÔºàÂèØÈÄâÔºâ
                                    </label>
                                    <input 
                                        id="s3_custom_url"
                                        v-model="systemSettings.s3_custom_url"
                                        type="text" 
                                        class="setting-input w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary focus:border-primary dark:focus:ring-primary/70 dark:focus:border-primary/70 transition-colors outline-none"
                                        placeholder="Â¶ÇÔºöhttps://cdn.example.com"
                                        @blur="handleFieldBlur('s3_custom_url', systemSettings.s3_custom_url)"
                                    />
                                    <div class="mt-1 text-gray-500 dark:text-gray-400 text-xs">
                                        ÁïôÁ©∫Âàô‰ΩøÁî®ÂõæÂ∫äÈªòËÆ?URLÔºåÂ°´ÂÜôÂàô‰ΩøÁî® S3/R2 ÂéüÂßãÈìæÊé•
                                    </div>
                                </div>
                            </div>

                            <!-- WebDAVÈÖçÁΩÆÔºöÂ§±ÂéªÁÑ¶ÁÇπ‰øùÂ≠?-->
                            <div v-if="systemSettings.storage_type === 'webdav'" class="space-y-4 pt-2 border-t border-gray-200 dark:border-gray-700"> 
                                <h3 class="font-bold text-sm text-gray-800 dark:text-gray-200">WebDav ÈÖçÁΩÆ</h3>

                                <div class="setting-group"> 
                                    <label class="setting-label block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" for="webdav_url">
                                        WebDav URL
                                    </label>
                                    <input 
                                        id="webdav_url"
                                        v-model="systemSettings.webdav_url"
                                        type="text"
                                        class="setting-input w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary focus:border-primary dark:focus:ring-primary/70 dark:focus:border-primary/70 transition-colors outline-none"
                                        placeholder="ËØ∑Â°´ÂÜ?WebDav Âú∞ÂùÄ"
                                        @blur="handleFieldBlur('webdav_url', systemSettings.webdav_url)"
                                    />
                                </div>
                                <div class="setting-group"> 
                                    <label class="setting-label block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" for="webdav_user">
                                        WebDav Áî®Êà∑Âê?
                                    </label>
                                    <input 
                                        id="webdav_user"
                                        v-model="systemSettings.webdav_user"
                                        type="text"
                                        class="setting-input w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary focus:border-primary dark:focus:ring-primary/70 dark:focus:border-primary/70 transition-colors outline-none"
                                        placeholder="ËØ∑Â°´ÂÜ?WebDav Áî®Êà∑Âê?
                                        @blur="handleFieldBlur('webdav_user', systemSettings.webdav_user)"
                                    />
                                </div>
                                <div class="setting-group"> 
                                    <label class="setting-label block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" for="webdav_pass">
                                        WebDav ÂØÜÁ†Å
                                    </label>
                                    <input 
                                        id="webdav_pass"
                                        v-model="systemSettings.webdav_pass"
                                        type="password"
                                        class="setting-input w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary focus:border-primary dark:focus:ring-primary/70 dark:focus:border-primary/70 transition-colors outline-none"
                                        placeholder="ËØ∑Â°´ÂÜ?WebDav ÂØÜÁ†Å"
                                        @blur="handleFieldBlur('webdav_pass', systemSettings.webdav_pass)"
                                    />
                                </div>
                            </div>

                            <!-- FTPÈÖçÁΩÆÔºöÂ§±ÂéªÁÑ¶ÁÇπ‰øùÂ≠?-->
                            <div v-if="systemSettings.storage_type === 'ftp'" class="space-y-4 pt-2 border-t border-gray-200 dark:border-gray-700"> 
                                <h3 class="font-bold text-sm text-gray-800 dark:text-gray-200">FTP ÈÖçÁΩÆ</h3>

                                <div class="setting-group"> 
                                    <label class="setting-label block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" for="ftp_host">
                                        FTP HOST
                                    </label>
                                    <input 
                                        id="ftp_host"
                                        v-model="systemSettings.ftp_host"
                                        type="text"
                                        class="setting-input w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary focus:border-primary dark:focus:ring-primary/70 dark:focus:border-primary/70 transition-colors outline-none"
                                        placeholder="ËØ∑Â°´ÂÜ?FTP IPÊàñÂüüÂê?
                                        @blur="handleFieldBlur('ftp_host', systemSettings.ftp_host)"
                                    />
                                </div>
                                <div class="mt-1 text-gray-500 dark:text-gray-400 text-xs">
                                    Áõ¥Êé•Â°´ÂÜôIPÊàñÂüüÂêçÔºåÊó†ÈúÄÂ°´ÂÜô ftp:// ÊàñËÄ?sftp://
                                </div>
                                <div class="setting-group"> 
                                    <label class="setting-label block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" for="ftp_port">
                                        FTP Á´ØÂè£
                                    </label>
                                    <input 
                                        id="ftp_port"
                                        v-model="systemSettings.ftp_port"
                                        type="number"
                                        class="setting-input w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary focus:border-primary dark:focus:ring-primary/70 dark:focus:border-primary/70 transition-colors outline-none"
                                        placeholder="FTP ÈªòËÆ§Á´ØÂè£Âè?21"
                                        @blur="handleFieldBlur('ftp_port', systemSettings.ftp_port)"
                                    />
                                </div>
                                <div class="setting-group"> 
                                    <label class="setting-label block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" for="ftp_user">
                                        FTP Áî®Êà∑Âê?
                                    </label>
                                    <input 
                                        id="ftp_user"
                                        v-model="systemSettings.ftp_user"
                                        type="password"
                                        class="setting-input w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary focus:border-primary dark:focus:ring-primary/70 dark:focus:border-primary/70 transition-colors outline-none"
                                        placeholder="ËØ∑Â°´ÂÜ?FTP Áî®Êà∑Âê?
                                        @blur="handleFieldBlur('ftp_user', systemSettings.ftp_user)"
                                    />
                                </div>
                                <div class="setting-group"> 
                                    <label class="setting-label block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" for="ftp_pass">
                                        FTP ÂØÜÁ†Å
                                    </label>
                                    <input 
                                        id="ftp_pass"
                                        v-model="systemSettings.ftp_pass"
                                        type="password"
                                        class="setting-input w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary focus:border-primary dark:focus:ring-primary/70 dark:focus:border-primary/70 transition-colors outline-none"
                                        placeholder="ËØ∑Â°´ÂÜ?FTP ÁôªÂΩïÂØÜÁ†Å"
                                        @blur="handleFieldBlur('ftp_pass', systemSettings.ftp_pass)"
                                    />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Á≥ªÁªüËÆæÁΩÆÂç°ÁâáÔºàÂºÄÂÖ≥ÈÉ®ÂàÜ‰∏çÂèòÔºâ -->
                <div class="order-2 md:order-1 w-full p-0 mx-auto">
                    <div class="panel-content p-6 md:p-8 bg-white dark:bg-gray-800 rounded-xl shadow-md">
                        <h2 class="panel-title flex items-center text-xl font-semibold mb-8">
                            <span class="panel-icon mr-2 text-2xl">
                                <i class="ri-settings-2-line"></i>
                            </span>
                            Á≥ªÁªüËÆæÁΩÆ
                        </h2>
                        
                        <div class="account-form space-y-6">
                            <!-- ÊòØÂê¶‰øùÂ≠òÂéüÂõæ -->
                            <div class="setting-group flex items-center justify-between py-2">
                                <label class="setting-label text-sm font-medium text-gray-700 dark:text-gray-300">
                                    ‰øùÂ≠òÂéüÂõæ
                                </label>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input 
                                        type="checkbox" 
                                        v-model="systemSettings.original_image"
                                        class="sr-only peer"
                                        @change="handleSwitchChange('original_image', systemSettings.original_image)"
                                    >
                                    <div class="w-12 h-6 bg-gray-200 dark:bg-gray-700 rounded-full peer-checked:bg-green-500 dark:peer-checked:bg-green-600 switch-transition switch-antialias"></div>
                                    <div class="absolute left-1 top-1 bg-white dark:bg-gray-200 w-4 h-4 rounded-full switch-transition switch-antialias peer-checked:translate-x-6"></div>
                                </label>
                            </div>
                            
                            <!-- ÂÖ∂‰ªñÂºÄÂÖ≥ÁúÅÁï•ÔºàÂíå‰πãÂâç‰∏ÄËá¥Ôºâ -->
                            <div class="setting-group flex items-center justify-between py-2">
                                <label class="setting-label text-sm font-medium text-gray-700 dark:text-gray-300">
                                    ‰øùÂ≠òWEBPÊ†ºÂºè
                                </label>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input 
                                        type="checkbox" 
                                        v-model="systemSettings.save_webp"
                                        class="sr-only peer"
                                        @change="handleSwitchChange('save_webp', systemSettings.save_webp)"
                                    >
                                    <div class="w-12 h-6 bg-gray-200 dark:bg-gray-700 rounded-full peer-checked:bg-green-500 dark:peer-checked:bg-green-600 switch-transition switch-antialias"></div>
                                    <div class="absolute left-1 top-1 bg-white dark:bg-gray-200 w-4 h-4 rounded-full switch-transition switch-antialias peer-checked:translate-x-6"></div>
                                </label>
                            </div>
                            <div class="setting-group flex items-center justify-between py-2">
                                <label class="setting-label text-sm font-medium text-gray-700 dark:text-gray-300">
                                    ÁîüÊàêÁº©Áï•Âõ?
                                </label>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input 
                                        type="checkbox" 
                                        v-model="systemSettings.thumbnail"
                                        class="sr-only peer"
                                        @change="handleSwitchChange('thumbnail', systemSettings.thumbnail)"
                                    >
                                    <div class="w-12 h-6 bg-gray-200 dark:bg-gray-700 rounded-full peer-checked:bg-green-500 dark:peer-checked:bg-green-600 switch-transition switch-antialias"></div>
                                    <div class="absolute left-1 top-1 bg-white dark:bg-gray-200 w-4 h-4 rounded-full switch-transition switch-antialias peer-checked:translate-x-6"></div>
                                </label>
                            </div>
                            <div class="mt-1 text-gray-500 dark:text-gray-400 text-xs">ÁîüÊàêÁº©Áï•ÂõæÔºåÂèØÊèêÂçáÂêéÂè∞È¢ÑËßàÈÄüÂ∫¶Ôºå‰∏ä‰º†ÈÄüÂ∫¶Á®çÊÖ¢</div>
                            <div class="setting-group flex items-center justify-between py-2">
                                <label class="setting-label text-sm font-medium text-gray-700 dark:text-gray-300">
                                    ÂÖÅËÆ∏Ê∏∏ÂÆ¢ÁôªÂΩï
                                </label>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input 
                                        type="checkbox" 
                                        v-model="systemSettings.tourist"
                                        class="sr-only peer"
                                        @change="handleSwitchChange('tourist', systemSettings.tourist)"
                                    >
                                    <div class="w-12 h-6 bg-gray-200 dark:bg-gray-700 rounded-full peer-checked:bg-green-500 dark:peer-checked:bg-green-600 switch-transition switch-antialias"></div>
                                    <div class="absolute left-1 top-1 bg-white dark:bg-gray-200 w-4 h-4 rounded-full switch-transition switch-antialias peer-checked:translate-x-6"></div>
                                </label>
                            </div>
                            <div class="mt-1 text-gray-500 dark:text-gray-400 text-xs">ÂºÄÂêØÂêéËÆøÈóÆÁôªÂΩïÈ°µÂ∞ÜËá™Âä®‰ª•Ê∏∏ÂÆ¢Ë∫´‰ªΩÁôªÂΩ?/div>
                            <div class="setting-group flex items-center justify-between py-2">
                                <label class="setting-label text-sm font-medium text-gray-700 dark:text-gray-300">
                                    ÂêØÁî®TGÈÄöÁü•
                                </label>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input 
                                        type="checkbox" 
                                        v-model="systemSettings.tg_notice"
                                        class="sr-only peer"
                                        @change="handleSwitchChange('tg_notice', systemSettings.tg_notice)"
                                    >
                                    <div class="w-12 h-6 bg-gray-200 dark:bg-gray-700 rounded-full peer-checked:bg-pink-500 dark:peer-checked:bg-pink-600 switch-transition switch-antialias"></div>
                                    <div class="absolute left-1 top-1 bg-white dark:bg-gray-200 w-4 h-4 rounded-full switch-transition switch-antialias peer-checked:translate-x-6"></div>
                                </label>
                            </div>
                            <div class="mt-1 text-gray-500 dark:text-gray-400 text-xs">ÂõΩÂÜÖÊúçÂä°Âô®‰∏çË¶ÅÂºÄÂêØTGÈÄöÁü•</div>
                            <!-- TG Webhook ‰∏ä‰º†ÂºÄÂÖ?-->
                            <div class="setting-group flex items-center justify-between py-2">
                                <label class="setting-label text-sm font-medium text-gray-700 dark:text-gray-300">
                                    ÂêØÁî®TG Webhook‰∏ä‰º†
                                </label>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input 
                                        type="checkbox" 
                                        v-model="systemSettings.tg_webhook"
                                        class="sr-only peer"
                                        @change="handleSwitchChange('tg_webhook', systemSettings.tg_webhook)"
                                    >
                                    <div class="w-12 h-6 bg-gray-200 dark:bg-gray-700 rounded-full peer-checked:bg-pink-500 dark:peer-checked:bg-pink-600 switch-transition switch-antialias"></div>
                                    <div class="absolute left-1 top-1 bg-white dark:bg-gray-200 w-4 h-4 rounded-full switch-transition switch-antialias peer-checked:translate-x-6"></div>
                                </label>
                            </div>
                            <div class="mt-1 text-gray-500 dark:text-gray-400 text-xs">ÂºÄÂêØÂêéÂèØÂêë Bot ÂèëÈÄÅÂõæÁâ?URL Êù•‰∏ä‰º†ÂõæÁâáÔºàÈúÄÂ°´ÂÜôÂüüÂêçÂí?Bot TokenÔº?/div>
                            <div class="setting-group flex items-center justify-between py-2">
                                <label class="setting-label text-sm font-medium text-gray-700 dark:text-gray-300">
                                    TurnstileÈ™åËØÅ
                                </label>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input 
                                        type="checkbox" 
                                        v-model="systemSettings.turnstile"
                                        class="sr-only peer"
                                        @change="handleSwitchChange('turnstile', systemSettings.turnstile)"
                                    >
                                    <div class="w-12 h-6 bg-gray-200 dark:bg-gray-700 rounded-full peer-checked:bg-orange-500 dark:peer-checked:bg-orange-600 switch-transition switch-antialias"></div>
                                    <div class="absolute left-1 top-1 bg-white dark:bg-gray-200 w-4 h-4 rounded-full switch-transition switch-antialias peer-checked:translate-x-6"></div>
                                </label>
                            </div>
                            <div class="setting-group flex items-center justify-between py-2">
                                <label class="setting-label text-sm font-medium text-gray-700 dark:text-gray-300">
                                    ÂºÄÂêØÂõæÁâáÊ∞¥Âç?
                                </label>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input 
                                        type="checkbox" 
                                        v-model="systemSettings.watermark_enable"
                                        class="sr-only peer"
                                        @change="handleSwitchChange('watermark_enable', systemSettings.watermark_enable)"
                                    >
                                    <div class="w-12 h-6 bg-gray-200 dark:bg-gray-700 rounded-full peer-checked:bg-green-500 dark:peer-checked:bg-green-600 switch-transition switch-antialias"></div>
                                    <div class="absolute left-1 top-1 bg-white dark:bg-gray-200 w-4 h-4 rounded-full switch-transition switch-antialias peer-checked:translate-x-6"></div>
                                </label>
                            </div>
                            <!-- Ê∞¥Âç∞ËØ¶ÁªÜÈÖçÁΩÆ -->
                            <div v-show="systemSettings.watermark_enable" class="pl-0 mt-4 space-y-4 border-t border-gray-100 dark:border-gray-700 pt-4">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="setting-group">
                                        <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1">Ê∞¥Âç∞ÊñáÊú¨</label>
                                        <input v-model="systemSettings.watermark_text" type="text" class="w-full px-3 py-2 text-sm border border-gray-200 dark:border-gray-600 rounded bg-gray-50 dark:bg-gray-700/50 focus:outline-none focus:border-primary" placeholder="Ê∞¥Âç∞ÊñáÊú¨" @blur="handleFieldBlur('watermark_text', systemSettings.watermark_text)">
                                    </div>
                                    <div class="setting-group">
                                        <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1">Â≠ó‰ΩìÂ§ßÂ∞è</label>
                                        <input v-model="systemSettings.watermark_size" type="text" class="w-full px-3 py-2 text-sm border border-gray-200 dark:border-gray-600 rounded bg-gray-50 dark:bg-gray-700/50 focus:outline-none focus:border-primary" placeholder="Â¶?20" @blur="handleFieldBlur('watermark_size', systemSettings.watermark_size)">
                                    </div>
                                    <div class="setting-group">
                                        <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1">Â≠ó‰ΩìÈ¢úËâ≤</label>
                                        <input v-model="systemSettings.watermark_color" type="text" class="w-full px-3 py-2 text-sm border border-gray-200 dark:border-gray-600 rounded bg-gray-50 dark:bg-gray-700/50 focus:outline-none focus:border-primary" placeholder="#000000" @blur="handleFieldBlur('watermark_color', systemSettings.watermark_color)">
                                    </div>
                                    <div class="setting-group">
                                        <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1">ÈÄèÊòéÂ∫?(0-1)</label>
                                        <input v-model="systemSettings.watermark_opac" type="text" class="w-full px-3 py-2 text-sm border border-gray-200 dark:border-gray-600 rounded bg-gray-50 dark:bg-gray-700/50 focus:outline-none focus:border-primary" placeholder="0.5" @blur="handleFieldBlur('watermark_opac', systemSettings.watermark_opac)">
                                    </div>
                                    <div class="setting-group col-span-1 md:col-span-2">
                                        <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1">‰ΩçÁΩÆ</label>
                                        <select v-model="systemSettings.watermark_pos" class="w-full px-3 py-2 text-sm border border-gray-200 dark:border-gray-600 rounded bg-gray-50 dark:bg-gray-700/50 focus:outline-none focus:border-primary" @change="handleSelectChange('watermark_pos', systemSettings.watermark_pos)">
                                            <option value="top-left">Â∑¶‰∏äËß?/option>
                                            <option value="top-right">Âè≥‰∏äËß?/option>
                                            <option value="bottom-left">Â∑¶‰∏ãËß?/option>
                                            <option value="bottom-right">Âè≥‰∏ãËß?/option>
                                            <option value="center">Â±Ö‰∏≠</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-1 text-gray-500 dark:text-gray-400 text-xs">Êñ∞‰∏ä‰º†ÁöÑÂõæÁâáËá™Âä®Ê∑ªÂä†Ê∞¥Âç∞ÔºåÂ∑≤‰∏ä‰º†ÁöÑÂõæÁâá‰∏ç‰ºöÊ∑ªÂä†Ê∞¥Âç∞„Ä?/div>
                            <div class="setting-group flex items-center justify-between py-2">
                                <label class="setting-label text-sm font-medium text-gray-700 dark:text-gray-300">
                                    ÂºÄÂêØÊù•Ê∫êÁôΩÂêçÂçï
                                </label>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input 
                                        type="checkbox" 
                                        v-model="systemSettings.referer_white_enable"
                                        class="sr-only peer"
                                        @change="handleSwitchChange('referer_white_enable', systemSettings.referer_white_enable)"
                                    >
                                    <div class="w-12 h-6 bg-gray-200 dark:bg-gray-700 rounded-full peer-checked:bg-green-500 dark:peer-checked:bg-green-600 switch-transition switch-antialias"></div>
                                    <div class="absolute left-1 top-1 bg-white dark:bg-gray-200 w-4 h-4 rounded-full switch-transition switch-antialias peer-checked:translate-x-6"></div>
                                </label>
                            </div>
                            <!-- Referer ÁôΩÂêçÂçïÈÖçÁΩ?-->
                            <div v-show="systemSettings.referer_white_enable" class="pl-0 mt-4 space-y-2 border-t border-gray-100 dark:border-gray-700 pt-4">
                                <label class="block text-xs font-medium text-gray-500 dark:text-gray-400">ÂÖÅËÆ∏ÁöÑÂüüÂêçÂàóË°?/label>
                                <textarea 
                                    v-model="systemSettings.referer_white_list"
                                    class="w-full px-3 py-2 text-sm border border-gray-200 dark:border-gray-600 rounded bg-gray-50 dark:bg-gray-700/50 focus:outline-none focus:border-primary"
                                    placeholder="example.com, test.com"
                                    rows="3"
                                    @blur="handleFieldBlur('referer_white_list', systemSettings.referer_white_list)"
                                ></textarea>
                                <div class="text-[10px] text-gray-400">‰ªÖÈúÄÂ°´ÂÜôÂüüÂêçÔºåÂ§ö‰∏™Áî®ÈÄóÂè∑ÂàÜÈöî„ÄÇÊó†ÈúÄhttp/Á´ØÂè£„Ä?/div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</template>

<script setup>
import { ref, onMounted, reactive } from 'vue'
import message from '@/utils/message.js'

const systemSettings = reactive({
    id: 1,
    original_image: false,
    save_webp: false,
    thumbnail: false,
    tourist: false,
    tg_notice: false,
    tg_webhook: false,
    turnstile: false,
    site_domain: '',
    tg_bot_token: '',
    tg_receivers: '',
    tg_notice_text: '',
    storage_type: '',
    s3_endpoint: '',
    s3_access_key: '',
    s3_secret_key: '',
    s3_bucket: '',
    s3_custom_url: '',
    webdav_url: '',
    webdav_user: '',
    webdav_pass: '',
    ftp_host: '',
    ftp_port: 21,
    ftp_user: '',

    ftp_pass: '',
    custom_api_url: '',
    custom_api_key: '',
    watermark_enable: '',
    watermark_text: '',
    watermark_pos: '',
    watermark_size: '',
    watermark_color: '',
    watermark_opac: '',
    referer_white_list: '',
    referer_white_enable: false
})

const updateSetting = reactive({})

// Âä†ËΩΩÁä∂ÊÄ?
const isUpdating = ref(false)
let debounceTimer = null

// Áªü‰∏ÄËØ∑Ê±ÇÂ§¥ÈÖçÁΩÆÔºàÂ§çÁî®Ôº?
const getRequestHeaders = () => {
    return {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
    }
}

const saveSetting = async (key, value) => {
    if (updateSetting?.[key] === value) {
        return
    }
    clearTimeout(debounceTimer)
    debounceTimer = setTimeout(async () => {
        try {
            if (isUpdating.value) return
            isUpdating.value = true

            const response = await fetch('/api/settings/update', {
                method: 'POST',
                headers: getRequestHeaders(),
                body: JSON.stringify({
                    key: key,
                    value: value
                })
            })
            
            const result = await response.json()
            
            if (response.ok && result.code === 200) {
                message.success(`Êõ¥Êñ∞ÊàêÂäü`)
                updateSetting[key] = value
            } else {
                // Êõ¥Êñ∞Â§±Ë¥•Ëá™Âä®ÂõûÊªö
                if (updateSetting[key]) {
                    systemSettings[key] = updateSetting[key]
                }
                message.error(`Êõ¥Êñ∞Â§±Ë¥•Ôº?{result.message || 'Êú™Áü•ÈîôËØØ'}`)
            }
        } catch (error) {
            console.error(`‰øùÂ≠òÂ§±Ë¥•:`, error)
            message.error(`Êõ¥Êñ∞Â§±Ë¥•ÔºöÁΩëÁªúÂºÇÂ∏∏`)
        } finally {
            isUpdating.value = false
        }
    }, 300)
}

// ÂºÄÂÖ≥Áä∂ÊÄÅÂèòÊõ¥Áªü‰∏ÄÂ§ÑÁêÜÊñπÊ≥ï
const handleSwitchChange = (key, value) => {
    saveSetting(key, value)
}

// ËæìÂÖ•Ê°ÜÂ§±ÂéªÁÑ¶ÁÇπÂ§ÑÁê?
const handleFieldBlur = (key, value) => {
    if (key == 'tg_bot_token' || key == 'tg_receivers') {
        if (systemSettings.tg_bot_token == '' || systemSettings.tg_receivers == '') {
            if(systemSettings.storage_type === 'telegram'){
                // Êú™ËÆæÁΩÆÊú∫Âô®‰∫∫‰ª§ÁâåÂíåÊé•Êî∂ËÄÖÂàóË°®Êó∂ÔºåËá™Âä®ÂàáÂõûÈªòËÆ§Â≠òÂÇ®ÊñπÂº?
                message.warning('ÈÖçÁΩÆ‰∏çÂÆåÊï¥ÔºåÂàáÂõûÈªòËÆ§Â≠òÂÇ®ÊñπÂºè')
                setTimeout(() => {
                    systemSettings.storage_type = 'default'
                    saveSetting("storage_type", 'default')
                }, 1500)
                
                return
            }
        }
    }
    saveSetting(key, value)
}

// ‰∏ãÊãâÊ°ÜÂèòÊõ¥Â§ÑÁê?
const handleSelectChange = (key, value) => {
    if(key == 'storage_type' && value === 'telegram'){
        if(!systemSettings.tg_bot_token || !systemSettings.tg_receivers){
            message.warning('ËØ∑ÂÖàÂ°´ÂÜôÊú∫Âô®‰∫∫‰ª§ÁâåÂíåÊé•Êî∂ËÄÖÂàóË°?)
            // ÈáçÁΩÆ‰∏ãÊãâ
            if(updateSetting?.storage_type) {
                systemSettings.storage_type = updateSetting.storage_type
            } else {
                systemSettings.storage_type = 'default'
            }
            return
        }
    }
    saveSetting(key, value)
}

// Ëé∑ÂèñÁ≥ªÁªüËÆæÁΩÆ
const getSettings = async () => { 
    try {
        const response = await fetch('/api/settings/get', {
            method: 'GET',
            headers: getRequestHeaders(),
        })
        
        if (!response.ok) {
            throw new Error(`ËØ∑Ê±ÇÂ§±Ë¥•Ôº?{response.status}`)
        }
        
        const result = await response.json()
        
        if (result.code === 200 && result.data) {
            Object.assign(systemSettings, result.data)
            Object.assign(updateSetting, result.data)
        } else {
            message.error(result.message || 'Ëé∑ÂèñËÆæÁΩÆÂ§±Ë¥•ÔºöÊó†Êï∞ÊçÆ')
        }
    } catch (error) {
        console.error('Ëé∑ÂèñËÆæÁΩÆÂ§±Ë¥•:', error)
        message.error(error.message || 'Ëé∑ÂèñËÆæÁΩÆÂ§±Ë¥•ÔºöÁΩëÁªúÂºÇÂ∏?)
    }
}

onMounted(() => {
    getSettings()
})
</script>

<style scoped>
.switch-transition {
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
}
.switch-antialias {
    transform: translateZ(0);
}
</style>
